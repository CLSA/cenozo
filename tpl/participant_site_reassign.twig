{##
 # participant_site_reassign.twig
 # 
 # Form to mass reassign the preferred site of multiple participants
 # @author Patrick Emond <emondpd@mcmaster.ca>
 # @see widget.twig for parameters
 #}
{% extends "base_participant_multi.twig" %}

{% block javascript %}

  {{ parent() }}
  <script type="text/javascript">
    $( function () {
      
      // appointment drop-down changed
      $( "#{{ widget.full }}__appointment_id" ).change( function () {
        populate_site_list( $( "#{{ widget.full }}__appointment_id" ).val() );
      } );
    
      // populate the list on load
      populate_site_list( $( "#{{ widget.full }}__appointment_id" ).val() );

    } );

    // populate site drop-down with the selected appointment's sites
    function populate_site_list( appointment_id ) {
      var options = {
        {% for appointment in appointments %}
          "{{ appointment.id }}": {
            "0": "None",
            {% for site in appointment.sites %}
              "{{ site.id }}": "{{ site.name }}",
            {% endfor %}
          },
        {% endfor %}
      };

      // remove all options and replace them with the choosen appointment's sites
      $site_select = $( "#{{ widget.full }}__site_id" );
      $site_select.children().remove();
      $.each( options[appointment_id], function( key, value ) {
        $site_select.append( $('<option>', { value: key } ).text( value ) );
      } );
    }
  </script>

{% endblock javascript %}
